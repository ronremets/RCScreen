<DynamicButton@Button>:
    font_size: self.height / 2
    texture_size: self.width / 2, self.height / 2
    on_texture_size:
        self.font_size = self.height / 2
        self.texture_size = self.width / 2, self.height / 2


<DynamicLabel@Label>:
    font_size: self.height / 2
    texture_size: self.width / 2, self.height / 2
    on_texture_size:
        self.font_size = self.height / 2
        self.texture_size = self.width / 2, self.height / 2


WindowManager:
    LoginScreen:
    SignupScreen:
    MainMenuScreen:
    SettingsScreen:
    HelpScreen:
    FeedbackScreen:
    ConnectScreen:
    ControllerScreen:
    ControlledScreen:

<LoginScreen>:
    login_button: login_button
    username_text_input: username_text_input
    password_text_input: password_text_input
    name: "login"
    GridLayout:
        size: self.size
        pos: self.pos
        rows: 3
        cols: 2
        padding:
            ((self.width / self.cols) * 0.25,
            (self.height / self.rows) * 0.2)
        spacing: (self.height / self.rows) * 0.2

        DynamicLabel:
            text: "Username:"

        TextInput:
            id: username_text_input
            text: "meme"

        DynamicLabel:
            text: "Password:"

        TextInput:
            id: password_text_input
            text: "meme_is_good"

        DynamicButton:
            id: login_button
            text: "Login"
            on_press: root.on_login_button_press()

        DynamicButton:
            text: "Signup"
            on_press:
                root.manager.transition.direction = "right"
                app.root.current = "signup"


<SignupScreen>:
    signup_button: signup_button
    username_text_input: username_text_input
    password_text_input: password_text_input
    name: "signup"
    GridLayout:
        size: root.size
        pos: root.pos
        rows: 3
        cols: 2
        padding:
            ((self.width / self.cols) * 0.25,
            (self.height / self.rows) * 0.2)
        spacing: (self.height / self.rows) * 0.2

        DynamicLabel:
            text: "Username:"

        TextInput:
            id: username_text_input
            text: "meme"

        DynamicLabel:
            text: "Password:"

        TextInput:
            id: password_text_input
            text: "meme_is_good"

        DynamicButton:
            id: signup_button
            text: "Signup"
            on_press: root.on_signup_button_press()

        DynamicButton:
            text: "Back"
            on_press:
                root.manager.transition.direction = "left"
                app.root.current = "login"

<ConnectScreen>:
    name: "connect"
    user_selector:user_selector
    partner_label: partner_label
    controller_checkbox: controller_checkbox

    GridLayout:
        size: root.size
        pos: root.pos
        rows: 3
        cols: 2
        padding:
            ((self.width / self.cols) * 0.25,
            (self.height / self.rows) * 0.2)
        spacing: (self.height / self.rows) * 0.2

        UserSelector:
            id: user_selector
            text: "usernames"

        DynamicLabel:
            id: partner_label
            text: " "

        DynamicButton:
            text: "Connect"
            on_press:
                app.is_controller = root.controller_checkbox.active
                root.connect_to_partner()
                root.manager.transition.direction = "left"
                app.root.current = ("controller" if app.is_controller else "controlled")

        DynamicButton:
            text: "Back"
            on_press:
                root.manager.transition.direction = "right"
                app.root.current = "main"

        DynamicLabel:
            text: "Controller:"

        CheckBox:
            id: controller_checkbox


<MainMenuScreen>:
    name: "main"
    GridLayout:
        size: root.size
        rows: 5
        cols: 1
        padding:
            ((self.width / self.cols) * 0.25,
            (self.height / self.rows) * 0.2)
        spacing: (self.height / self.rows) * 0.2

        DynamicLabel:
            text: "RCScreen"

        DynamicButton:
            text: "Connect"
            on_press:
                root.manager.transition.direction = "left"
                app.root.current = "connect"

        DynamicButton:
            text: "Settings"
            on_press:
                root.manager.transition.direction = "left"
                app.root.current = "settings"

        DynamicButton:
            text: "Help"
            on_press:
                root.manager.transition.direction = "left"
                app.root.current = "help"

        DynamicButton:
            text: "Feedback"
            on_press:
                root.manager.transition.direction = "left"
                app.root.current = "feedback"


<HelpScreen>
    name: "help"
    GridLayout:
        size: root.size
        rows: 2
        cols: 1
        padding:
            ((self.width / self.cols) * 0.25,
            (self.height / self.rows) * 0.2)
        spacing: (self.height / self.rows) * 0.2
    
        DynamicLabel:
            text: "help screen"

        DynamicButton:
            text: "Back"
            on_press:
                root.manager.transition.direction = "right"
                app.root.current = "main"


<SettingsScreen>
    name: "settings"
    GridLayout:
        size: root.size
        rows: 2
        cols: 1
        padding:
            ((self.width / self.cols) * 0.25,
            (self.height / self.rows) * 0.2)
        spacing: (self.height / self.rows) * 0.2
    
        DynamicLabel:
            text: "settings screen"

        DynamicButton:
            text: "Back"
            on_press:
                root.manager.transition.direction = "right"
                app.root.current = "main"


<FeedbackScreen>
    name: "feedback"
    GridLayout:
        size: root.size
        rows: 5
        cols: 2
        padding:
            ((self.width / self.cols) * 0.25,
            (self.height / self.rows) * 0.2)
        spacing: (self.height / self.rows) * 0.2
    
        DynamicButton:
            text: "Back"
            on_press:
                root.manager.transition.direction = "right"
                app.root.current = "main"

        Label:

        DynamicLabel:
            text: "Enter Email:"

        TextInput:

        DynamicLabel:
            text: "Enter subject:"

        TextInput:

        DynamicLabel:
            text: "Enter description:"

        TextInput:

        Label:

        DynamicButton:
            text: "Submit"


<ErrorPopup>:
    GridLayout:
        size: root.size
        pos: root.pos
        rows: 3
        cols: 2
        padding:
            ((self.width / self.cols) * 0.25,
            (self.height / self.rows) * 0.2)
        spacing: (self.height / self.rows) * 0.2
    
        DynamicLabel:
            text: "error popup"

        DynamicButton:
            text: "Back"
            on_press:
                self.text = "pressed"

<ControllerScreen>
    screen: screen
    controller: controller
    name: "controller"

    StreamedImage:
        id: screen
        source: ""
        pos: (0, 0)
        size: root.size
        nocache: True
        allow_stretch: True

    DynamicButton:
        background_color: 1, 1, 1, 0.5
        size_hint: 0.1, 0.1
        pos: 0, root.height - self.height
        text: "Back"
        on_press:
            root.manager.transition.direction = "right"
            app.root.current = "connect"

    Controller:
        id: controller
        left_click_button: left_click_button
        right_click_button: right_click_button
        left_button: left_button
        right_button: right_button
        up_button: up_button
        down_button: down_button

        #size: 0.5 * root.width, 0.5 * root.height
        size_hint: 0.5, 0.5
        #size_hint: None, None
        pos: root.width - self.width, 0
        # pos_hint: {"x": 1, "y": 0}

        #DynamicButton:
        #    text: "all"
        #    size_hint: 1, 1
        #    pos_hint: {"x": 0, "y": 0}

        DynamicButton:
            id: left_click_button
            text: "Left click"
            size_hint: 0.25, 1 / 3
            pos:
                (self.width,
                0.5 * root.controller.height - self.height / 2)
            on_press: root.controller.left_mouse_button_pressed()

        DynamicButton:
            id: right_click_button
            text: "Right click"
            size_hint: 0.25, 1 / 3
            pos:
                (2 * self.width,
                0.5 * root.controller.height - self.height / 2)
            on_press: root.controller.right_mouse_button_pressed()

        DynamicButton:
            id: left_button
            text: "<"
            size_hint: 0.25, 1 / 3
            pos: (0, 0.5 * root.controller.height - self.height / 2)
            on_press: root.controller.move_mouse_left()

        DynamicButton:
            id: right_button
            text: ">"
            size_hint: 0.25, 1 / 3
            pos:
                (root.controller.width - self.width,
                0.5 * root.controller.height - self.height / 2)
            on_press: root.controller.move_mouse_right()

        DynamicButton:
            id: up_button
            text: "^"
            size_hint: 0.25, 1 / 3
            pos:
                (0.5 * root.controller.width - self.width / 2,
                root.controller.height - self.height)
            on_press: root.controller.move_mouse_up()

        DynamicButton:
            id: down_button
            text: "v"
            size_hint: 0.25, 1 / 3
            pos: (0.5 * root.controller.width - self.width / 2, 0)
            on_press: controller.move_mouse_down()

<ControlledScreen>
    name: "controlled"

    DynamicButton:
        background_color: 1, 1, 1, 0.5
        size: root.width / 10, root.height / 10
        size_hint: None, None
        pos: 0, root.height - self.height
        text: "Back"
        on_press:
            root.manager.transition.direction = "right"
            app.root.current = "connect"
